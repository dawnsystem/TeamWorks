# Plan Integral - Sistema de IA Avanzado

**Fecha**: 17 de Octubre de 2025  
**Versi√≥n**: 2.0  
**Estado**: En Implementaci√≥n

---

## üéØ Visi√≥n General

Transformar el sistema de IA de TeamWorks para que pueda realizar **todas las operaciones que un usuario puede hacer** y **m√°s**, incluyendo bulk actions, acciones secuenciales, y gesti√≥n inteligente de relaciones entre tareas.

---

## üìã Objetivos del Plan

### Objetivo Principal
Crear un asistente de IA que sea tan capaz como un usuario humano, pero m√°s eficiente, permitiendo:
1. Gesti√≥n completa de proyectos, secciones, tareas, etiquetas, comentarios y recordatorios
2. Operaciones en bulk (m√∫ltiples elementos a la vez)
3. Operaciones secuenciales (cadenas de acciones)
4. Gesti√≥n inteligente de relaciones entre tareas
5. Sugerencias contextuales basadas en el estado actual

### Objetivos Secundarios
- Mejorar la experiencia del usuario al completar tareas relacionadas
- Automatizar flujos de trabajo comunes
- Proporcionar feedback inteligente y proactivo
- Facilitar la organizaci√≥n y planificaci√≥n

---

## üîß Capacidades Actuales vs Planificadas

### ‚úÖ Implementado (Estado Actual)

#### Creaci√≥n B√°sica de Tareas
- Crear tarea con t√≠tulo
- Asignar prioridad (P1-P4, alta/media/baja)
- Fechas b√°sicas (hoy, ma√±ana, pasado ma√±ana)
- Asignaci√≥n autom√°tica a Inbox

#### Operaciones sobre Tareas
- Completar tarea por nombre
- Eliminar tareas completadas
- Consultar tareas pendientes (hoy, semana)

#### Sistema de Confianza
- Score de confianza (0-1)
- Modo manual y autom√°tico
- Explicaciones de acciones

### üöÄ A Implementar (Nuevas Capacidades)

## Fase 1: Creaci√≥n Avanzada de Tareas ‚úÖ COMPLETADA

### 1.1 Especificaci√≥n Completa de Propiedades ‚úÖ
- ‚úÖ T√≠tulo y descripci√≥n
- ‚úÖ Prioridad (4 niveles)
- ‚úÖ Fecha de vencimiento (parseo mejorado)
- ‚úÖ **Proyecto espec√≠fico** (no solo Inbox)
- ‚úÖ **Secci√≥n espec√≠fica** dentro del proyecto
- ‚úÖ **Etiquetas m√∫ltiples**
- ‚úÖ **Subtarea de otra tarea**

**Ejemplos de comandos**:
```
"crear tarea comprar leche prioridad alta para ma√±ana en proyecto Personal secci√≥n Compras con etiqueta urgente"

"a√±adir escribir informe como subtarea de preparar presentaci√≥n en proyecto Trabajo"

"nueva tarea llamar al dentista para el pr√≥ximo lunes con etiquetas salud y personal"
```

### 1.2 Parseo Avanzado de Fechas ‚úÖ
- ‚úÖ hoy, ma√±ana, pasado ma√±ana
- ‚úÖ D√≠as de la semana ("pr√≥ximo lunes", "este viernes")
- ‚úÖ Fechas relativas ("en 3 d√≠as", "en 2 semanas")
- ‚úÖ Fechas absolutas ("25 de diciembre", "15/10/2025")
- ‚è∏Ô∏è Rangos ("del 10 al 15 de noviembre") - Pendiente

## Fase 2: Operaciones Bulk (M√∫ltiples Elementos) ‚úÖ COMPLETADA

### 2.1 Creaci√≥n en Bulk ‚úÖ
**Objetivo**: Crear m√∫ltiples elementos en un solo comando

**Casos de uso**:
```
"crear 5 tareas: comprar leche, sacar la basura, lavar ropa, llamar a mam√°, pagar facturas todas para hoy prioridad media"

"a√±adir tareas para la semana: lunes reuni√≥n equipo, martes revisar presupuesto, mi√©rcoles presentaci√≥n cliente, jueves formaci√≥n, viernes revisi√≥n semanal"

"crear etiquetas: urgente rojo, opcional azul, en proceso amarillo, completado verde"
```

### 2.2 Modificaci√≥n en Bulk ‚úÖ COMPLETADA
**Objetivo**: Modificar m√∫ltiples tareas a la vez

**Casos de uso**:
```
"cambiar todas las tareas del proyecto Personal a prioridad alta"

"mover todas las tareas de la secci√≥n Backlog a la secci√≥n En Progreso"

"a√±adir etiqueta urgente a todas las tareas de hoy"

"completar todas las tareas con etiqueta quick-win"

"cambiar todas las tareas vencidas a pr√≥xima semana"
```

**Estado**: ‚úÖ Implementado - El sistema puede modificar m√∫ltiples tareas que coincidan con filtros espec√≠ficos

### 2.3 Eliminaci√≥n en Bulk ‚úÖ
**Objetivo**: Eliminar m√∫ltiples elementos con filtros

**Casos de uso**:
```
"eliminar todas las tareas completadas del proyecto Personal"

"borrar todas las tareas vencidas hace m√°s de 30 d√≠as"

"eliminar subtareas completadas de preparar presentaci√≥n"
```

## Fase 3: Acciones Secuenciales

### 3.1 Flujos de Creaci√≥n
**Objetivo**: Crear estructuras completas en un comando

**Casos de uso**:
```
"crear proyecto Marketing con secciones Planificaci√≥n, Ejecuci√≥n y An√°lisis y a√±adir tarea crear estrategia en Planificaci√≥n"

"preparar sprint: crear proyecto Sprint 10, secciones Todo, In Progress, Done y 10 tareas de backlog"

"configurar nuevo cliente: crear proyecto Cliente ABC con secciones Onboarding, Desarrollo, Testing, Deployment cada una con tarea inicial"
```

### 3.2 Flujos de Organizaci√≥n
**Objetivo**: Reorganizar m√∫ltiples elementos

**Casos de uso**:
```
"organizar tareas de hoy por prioridad en secciones"

"mover tareas completadas de todos los proyectos a archivo"

"agrupar tareas similares y crear proyecto para cada grupo"
```

### 3.3 Flujos Condicionales
**Objetivo**: Acciones con l√≥gica condicional

**Casos de uso**:
```
"si hay tareas vencidas hace m√°s de 7 d√≠as, moverlas a proyecto Backlog y quitar prioridad"

"si no hay tareas para hoy, sugerir 3 tareas del backlog"

"si proyecto tiene m√°s de 50 tareas, crear secci√≥n Archive y mover completadas"
```

## Fase 4: Gesti√≥n de Comentarios y Recordatorios ‚úÖ COMPLETADA

### 4.1 Comentarios v√≠a IA ‚úÖ
**Casos de uso**:
```
"a√±adir comentario en tarea comprar leche: verificar si queda algo en la nevera"

"comentar en todas las tareas de hoy: recordar actualizar estado al finalizar"

"a√±adir nota en preparar presentaci√≥n: incluir datos del √∫ltimo trimestre"
```

### 4.2 Recordatorios v√≠a IA ‚úÖ
**Casos de uso**:
```
"crear recordatorio para tarea reuni√≥n cliente 30 minutos antes"

"a√±adir recordatorios de 1 d√≠a antes a todas las tareas de esta semana"

"recordarme ma√±ana a las 9am revisar tareas pendientes"
```

## Fase 5: Actualizaci√≥n de Tareas Existentes ‚úÖ COMPLETADA

### 5.1 Modificaci√≥n de Propiedades ‚úÖ
**Casos de uso**:
```
"cambiar prioridad de comprar leche a alta"

"mover tarea escribir informe al proyecto Trabajo secci√≥n Documentaci√≥n"

"cambiar fecha de reuni√≥n cliente a pr√≥ximo martes"

"a√±adir etiquetas urgente y cliente a tarea preparar presupuesto"
```

### 5.2 Gesti√≥n de Subtareas ‚úÖ
**Casos de uso**:
```
"convertir tareas X, Y, Z en subtareas de proyecto principal"

"promover subtarea X a tarea independiente"

"crear 5 subtareas para tarea preparar presentaci√≥n: investigar, redactar, dise√±ar, revisar, practicar"
```

## Fase 6: B√∫squedas y Consultas Avanzadas

### 6.1 B√∫squedas Complejas
**Casos de uso**:
```
"mostrar tareas prioritarias sin fecha de vencimiento"

"qu√© tareas tengo del proyecto Trabajo con etiqueta urgente para esta semana"

"listar todas las tareas vencidas agrupadas por proyecto"

"encontrar tareas con la palabra 'cliente' en t√≠tulo o descripci√≥n"
```

### 6.2 An√°lisis y Estad√≠sticas
**Casos de uso**:
```
"cu√°ntas tareas complet√© esta semana"

"qu√© proyecto tiene m√°s tareas pendientes"

"mostrar distribuci√≥n de tareas por prioridad"

"cu√°l es mi tasa de completitud este mes"
```

### 6.3 Sugerencias Inteligentes
**Casos de uso**:
```
"qu√© deber√≠a hacer ahora" ‚Üí Sugiere tareas seg√∫n contexto

"sugerir tareas para completar hoy" ‚Üí Basado en prioridad, fecha, proyecto

"recomendar reorganizaci√≥n de proyectos" ‚Üí Detecta patrones y sugiere mejoras
```

## Fase 7: Gesti√≥n Inteligente de Relaciones

### 7.1 Detecci√≥n de Tareas Relacionadas
**Implementaci√≥n**:
- Detectar cuando se completa la √∫ltima subtarea de una tarea padre
- Detectar cuando se completan todas las tareas de una secci√≥n
- Detectar cuando se completan todas las tareas de un proyecto

### 7.2 Popup Inteligente al Completar Subtareas
**Trigger**: Usuario completa una subtarea y no quedan m√°s subtareas pendientes

**Opciones en el Popup**:
1. ‚úÖ **Completar tarea padre tambi√©n**
2. üí¨ **A√±adir comentario a la tarea padre** (ej: "Todas las subtareas completadas el [fecha]")
3. üìù **Crear nueva subtarea** (si falt√≥ algo)
4. üîÑ **Mover tarea padre a otra secci√≥n** (ej: de "En Progreso" a "Completado")
5. ‚è≠Ô∏è **Sugerir siguiente tarea** del mismo proyecto
6. ‚ùå **No hacer nada** (cerrar popup)

**Contexto Adicional**:
- Mostrar t√≠tulo de la tarea padre
- Mostrar proyecto y secci√≥n
- Mostrar estad√≠sticas (X de Y subtareas completadas)

### 7.3 Sugerencias Contextuales
**Casos de uso**:
- Al completar √∫ltima tarea de la secci√≥n ‚Üí "¬øCrear nueva secci√≥n o mover tarea?"
- Al crear muchas tareas sin fecha ‚Üí "¬øAsignar fechas autom√°ticamente?"
- Al tener muchas tareas vencidas ‚Üí "¬øReprogramar tareas vencidas?"

## Fase 8: Operaciones de Proyectos y Etiquetas ‚úÖ COMPLETADA

### 8.1 Gesti√≥n de Proyectos v√≠a IA ‚úÖ
**Casos de uso**:
```
"crear proyecto Marketing con color azul"

"cambiar color del proyecto Personal a verde" - Pendiente

"eliminar proyecto Archivo y mover tareas a Inbox" - Pendiente

"duplicar proyecto Template para nuevo cliente" - Pendiente
```

### 8.2 Gesti√≥n de Etiquetas v√≠a IA ‚úÖ
**Casos de uso**:
```
"crear etiqueta urgente con color rojo"

"cambiar nombre de etiqueta work a trabajo" - Pendiente

"eliminar etiqueta deprecated de todas las tareas" - Pendiente

"fusionar etiquetas importante y priority en una sola" - Pendiente
```

### 8.3 Gesti√≥n de Secciones v√≠a IA ‚úÖ
**Casos de uso**:
```
"crear secci√≥n Backlog en proyecto Desarrollo"

"renombrar secci√≥n Todo a Por Hacer" - Pendiente

"mover todas las tareas de secci√≥n Done a Archive" - Pendiente

"eliminar secci√≥n vac√≠a Testing" - Pendiente
```

---

## üèóÔ∏è Arquitectura T√©cnica

### Mejoras en `aiService.ts`

#### 1. Prompt Mejorado
```typescript
interface EnhancedAIContext {
  // Usuario y permisos
  userId: string;
  userName: string;
  
  // Contexto completo
  projects: Array<{ id, nombre, color, sections }>;
  labels: Array<{ id, nombre, color }>;
  recentTasks: Array<{ id, titulo, projectId, sectionId }>;
  
  // Estado actual
  currentView: 'inbox' | 'today' | 'week' | 'project';
  currentProjectId?: string;
  currentSectionId?: string;
  
  // Preferencias
  defaultProject?: string;
  timezone: string;
}
```

#### 2. Tipos de Acciones Extendidos
```typescript
type AIActionType = 
  // Tareas
  | 'create_task'
  | 'create_tasks_bulk'  // üÜï
  | 'update_task'         // üÜï
  | 'update_tasks_bulk'   // üÜï
  | 'delete_task'
  | 'delete_tasks_bulk'   // üÜï
  | 'complete_task'
  | 'complete_tasks_bulk' // üÜï
  
  // Proyectos
  | 'create_project'      // üÜï
  | 'update_project'      // üÜï
  | 'delete_project'      // üÜï
  
  // Secciones
  | 'create_section'      // üÜï
  | 'update_section'      // üÜï
  | 'delete_section'      // üÜï
  
  // Etiquetas
  | 'create_label'        // üÜï
  | 'update_label'        // üÜï
  | 'delete_label'        // üÜï
  | 'assign_labels'       // üÜï
  
  // Comentarios y Recordatorios
  | 'add_comment'         // üÜï
  | 'create_reminder'     // üÜï
  
  // Consultas
  | 'query_tasks'
  | 'query_analytics'     // üÜï
  
  // Flujos
  | 'sequential_actions'  // üÜï
  | 'conditional_action'; // üÜï
```

#### 3. Validaci√≥n y Seguridad
```typescript
interface ActionValidator {
  // Validar permisos del usuario
  validatePermissions(action: AIAction, userId: string): boolean;
  
  // Validar que los IDs existen
  validateReferences(action: AIAction): Promise<boolean>;
  
  // Validar coherencia de datos
  validateData(action: AIAction): boolean;
  
  // Sanitizar inputs
  sanitize(action: AIAction): AIAction;
}
```

### Mejoras en `aiController.ts`

#### 1. Ejecuci√≥n Transaccional
```typescript
async function executeActionsTransactional(
  actions: AIAction[],
  userId: string
): Promise<ActionResult[]> {
  return await prisma.$transaction(async (tx) => {
    const results = [];
    for (const action of actions) {
      const result = await executeAction(action, userId, tx);
      results.push(result);
      
      // Si una acci√≥n falla y es cr√≠tica, rollback
      if (!result.success && action.critical) {
        throw new Error(`Critical action failed: ${action.explanation}`);
      }
    }
    return results;
  });
}
```

#### 2. Sistema de Rollback
```typescript
interface ActionResult {
  action: AIAction;
  success: boolean;
  result?: any;
  error?: string;
  rollbackable: boolean;
  rollbackData?: any;
}

async function rollbackActions(
  results: ActionResult[]
): Promise<void> {
  // Revertir acciones en orden inverso
  for (const result of results.reverse()) {
    if (result.rollbackable && result.rollbackData) {
      await rollbackAction(result);
    }
  }
}
```

---

## üé® Componentes Frontend

### Nuevo: `TaskRelationshipManager.tsx`
**Responsabilidad**: Gestionar popup cuando se completa √∫ltima subtarea

```typescript
interface TaskRelationshipManagerProps {
  parentTask: Task;
  completedSubTaskId: string;
  onAction: (action: RelationshipAction) => void;
}

type RelationshipAction =
  | { type: 'complete_parent' }
  | { type: 'add_comment'; comment: string }
  | { type: 'create_subtask'; title: string }
  | { type: 'move_to_section'; sectionId: string }
  | { type: 'suggest_next' }
  | { type: 'dismiss' };
```

**UI del Popup**:
- Modal centrado con overlay
- T√≠tulo: "üéâ ¬°√öltima subtarea completada!"
- Informaci√≥n de tarea padre
- 6 botones de acci√≥n
- Dise√±o limpio y claro
- Animaci√≥n de celebraci√≥n (opcional)

### Mejoras en `AIAssistant.tsx`

#### 1. Ejemplos Din√°micos
Mostrar ejemplos basados en el contexto actual:
- Si est√°s en un proyecto ‚Üí ejemplos de ese proyecto
- Si es lunes ‚Üí ejemplos de planificaci√≥n semanal
- Si hay tareas vencidas ‚Üí ejemplos de reprogramaci√≥n

#### 2. Historial de Comandos
- Guardar √∫ltimos 10 comandos
- Autocompletar basado en historial
- Shortcuts para comandos frecuentes

#### 3. Modo Avanzado
Toggle para habilitar:
- Acciones bulk
- Acciones condicionales
- Flujos complejos
- Feedback t√©cnico

---

## üìä Plan de Implementaci√≥n

### Sprint 1: Fundamentos ‚úÖ COMPLETADO (Semana 1)
- [x] Documentaci√≥n consolidada
- [x] Mejora de parseo de fechas
- [x] Soporte para proyectos espec√≠ficos
- [x] Soporte para secciones
- [x] Soporte para etiquetas
- [x] Testing de creaci√≥n avanzada

### Sprint 2: Bulk Actions ‚úÖ COMPLETADO (Semana 2)
- [x] Crear m√∫ltiples tareas
- [x] Modificar m√∫ltiples tareas
- [x] Eliminar en bulk
- [ ] UI para confirmar bulk actions - PENDIENTE (opcional)
- [ ] Testing de bulk operations - PENDIENTE

### Sprint 3: Acciones Secuenciales ‚è∏Ô∏è PENDIENTE (Semana 3)
- [ ] Parser de flujos
- [ ] Ejecuci√≥n transaccional
- [ ] Rollback autom√°tico
- [ ] UI para feedback de flujos
- [ ] Testing de sequences

### Sprint 4: Gesti√≥n de Relaciones ‚è∏Ô∏è PENDIENTE (Semana 4)
- [ ] Detecci√≥n de subtareas completadas
- [ ] Componente TaskRelationshipManager
- [ ] Popup inteligente
- [ ] Sugerencias contextuales
- [ ] Testing de relaciones

### Sprint 5: Operaciones Avanzadas ‚úÖ COMPLETADO (Semana 5)
- [x] Gesti√≥n de proyectos v√≠a IA (creaci√≥n)
- [x] Gesti√≥n de etiquetas v√≠a IA (creaci√≥n)
- [x] Comentarios y recordatorios v√≠a IA
- [x] Actualizaci√≥n de tareas existentes
- [ ] Testing completo - PENDIENTE

### Sprint 6: B√∫squedas y Analytics ‚è∏Ô∏è PENDIENTE (Semana 6)
- [ ] B√∫squedas complejas
- [ ] Analytics b√°sicos
- [ ] Sugerencias inteligentes
- [ ] UI para visualizaci√≥n de consultas
- [ ] Testing de queries

### Sprint 7: Pulido y Documentaci√≥n ‚úÖ EN PROGRESO (Semana 7)
- [x] Optimizaci√≥n de prompts
- [ ] Mejora de UI/UX
- [x] Documentaci√≥n completa
- [x] Ejemplos y tutoriales
- [ ] Video demos

---

## üß™ Estrategia de Testing

### Tests Unitarios
- Parser de comandos
- Validaci√≥n de acciones
- Ejecuci√≥n de acciones individuales
- Rollback de acciones

### Tests de Integraci√≥n
- Flujos completos de creaci√≥n
- Bulk operations
- Secuencias de acciones
- Gesti√≥n de relaciones

### Tests E2E
- Casos de uso reales
- Comandos complejos
- Verificaci√≥n de UI
- Performance

### Tests de IA
- Accuracy de interpretaci√≥n
- Confidence scores apropiados
- Manejo de ambig√ºedad
- Edge cases

---

## üìà M√©tricas de √âxito

### M√©tricas de Funcionalidad
- Tipos de comandos soportados: objetivo 50+
- Tasa de √©xito de interpretaci√≥n: > 90%
- Tasa de √©xito de ejecuci√≥n: > 95%
- Cobertura de operaciones: 100% de lo que puede hacer un usuario

### M√©tricas de UX
- Tiempo medio para completar tarea con IA vs manual: < 50%
- Satisfacci√≥n del usuario: > 4.5/5
- Adopci√≥n de funci√≥n de IA: > 70% de usuarios activos
- Comandos por usuario activo por d√≠a: > 5

### M√©tricas T√©cnicas
- Tiempo de respuesta de IA: < 2s (p95)
- Tasa de error del sistema: < 1%
- Uptime del servicio de IA: > 99.9%
- Coste por comando: < $0.001

---

## üöß Consideraciones de Implementaci√≥n

### Rendimiento
- Cach√© de contexto de usuario (30 min TTL)
- Batch processing para bulk operations
- Ejecuci√≥n as√≠ncrona para operaciones largas
- Rate limiting por usuario

### Costos de IA
- Groq API es gratuito hasta cierto l√≠mite
- Monitorear uso por usuario
- Implementar fallback a modelo local si es necesario
- Optimizar prompts para reducir tokens

### Seguridad
- Validar todos los inputs
- Sanitizar comandos del usuario
- Verificar permisos en cada operaci√≥n
- Logging de acciones de IA para auditor√≠a
- Rate limiting para prevenir abuso

### Escalabilidad
- Queue system para operaciones pesadas
- Horizontal scaling del backend
- Database connection pooling
- CDN para assets del frontend

---

## üìö Documentaci√≥n a Crear/Actualizar

### Para Usuarios
- [ ] Gu√≠a completa de comandos de IA
- [ ] Tutorial interactivo
- [ ] Video demos de casos de uso
- [ ] FAQ de IA
- [ ] Tips y trucos

### Para Desarrolladores
- [ ] Arquitectura del sistema de IA
- [ ] API reference completa
- [ ] Gu√≠a de prompts
- [ ] Gu√≠a de testing
- [ ] Contributing guide

---

## üéØ Pr√≥ximos Pasos Inmediatos

1. ‚úÖ Consolidar documentaci√≥n existente
2. ‚úÖ Crear PLAN_IA.md (este documento)
3. ‚úÖ Implementar parseo mejorado de fechas
4. ‚úÖ A√±adir soporte para proyectos/secciones/etiquetas
5. ‚úÖ Implementar creaci√≥n de tareas mejorada
6. ‚úÖ Implementar subtareas, comentarios y recordatorios v√≠a IA
7. ‚è≠Ô∏è Implementar modificaciones bulk (cambiar m√∫ltiples tareas a la vez)
8. ‚è≠Ô∏è Implementar acciones secuenciales
9. ‚è≠Ô∏è Implementar detecci√≥n inteligente de tareas relacionadas
10. ‚è≠Ô∏è Testing exhaustivo de mejoras
11. ‚è≠Ô∏è Desplegar a producci√≥n

---

**Mantenido por**: Equipo de Desarrollo TeamWorks  
**√öltima Actualizaci√≥n**: 17 de Octubre de 2025  
**Estado**: Documento vivo - se actualiza con cada sprint
