# Gu√≠a de Configuraci√≥n para Acceso en Red Local

Esta gu√≠a te ayudar√° a configurar TeamWorks para que puedas acceder desde cualquier dispositivo en tu red local (m√≥vil, tablet, otro ordenador).

## üéâ ¬°Actualizado! Configuraci√≥n Autom√°tica Mejorada

TeamWorks ahora est√° completamente configurado para funcionar en red local **sin necesidad de configuraci√≥n manual**. El servidor acepta autom√°ticamente conexiones desde:
- ‚úÖ Localhost (127.0.0.1, localhost, 0.0.0.0)
- ‚úÖ Red local clase C (192.168.x.x)
- ‚úÖ Red local clase A (10.x.x.x)
- ‚úÖ Red local clase B (172.16.x.x - 172.31.x.x)

### Flujo de Configuraci√≥n Simplificado:

1. **Inicia el servidor** en tu PC principal (ver Paso 1 abajo)
2. **Abre TeamWorks** desde otro dispositivo: `http://[IP-DEL-SERVIDOR]:5173`
3. **Ver√°s un banner naranja** que detecta autom√°ticamente la configuraci√≥n necesaria
4. **Haz clic en "Configurar Autom√°ticamente"** y ¬°listo! üéä

El sistema verificar√° que el servidor est√© accesible y configurar√° todo por ti autom√°ticamente.

---

## Paso 1: Configuraci√≥n del Servidor

El servidor ya est√° configurado para:
- ‚úÖ Escuchar en todas las interfaces de red (`0.0.0.0`)
- ‚úÖ Aceptar conexiones CORS desde cualquier IP de red local
- ‚úÖ Manejar credenciales de autenticaci√≥n de forma segura

**No necesitas hacer cambios en el c√≥digo ni en archivos .env para la configuraci√≥n de red local.**

### 1.1 Iniciar el Servidor

```bash
cd server
npm run dev
```

Deber√≠as ver:
```
üöÄ Server running on http://0.0.0.0:3000
üì° Accessible on local network
```

### 1.2 Obtener la IP Local del Servidor

#### Windows
```bash
ipconfig
```
Busca "IPv4 Address" en tu adaptador de red activo. Ejemplo: `192.168.0.165`

#### macOS / Linux
```bash
ifconfig
# o
ip addr show
```
Busca la IP que empieza con `192.168.` o `10.0.`. Ejemplo: `192.168.0.165`

### 1.3 Verificar el Firewall (si hay problemas)

Si no puedes conectar desde otros dispositivos, aseg√∫rate de que el firewall permite el puerto 3000:

#### Windows
```bash
# Como administrador
netsh advfirewall firewall add rule name="TeamWorks" dir=in action=allow protocol=TCP localport=3000
```

#### macOS
```bash
# El firewall de macOS generalmente no bloquea por defecto
# Si lo tienes activado, a√±ade una excepci√≥n para Node.js
```

#### Linux (UFW)
```bash
sudo ufw allow 3000/tcp
```

## Paso 2: Configuraci√≥n del Cliente

### 2.1 Iniciar el Cliente de Desarrollo (Opcional)

Si quieres usar el cliente de desarrollo en la misma m√°quina:

```bash
cd client
npm run dev
```

El cliente estar√° disponible en `http://localhost:5173`

### 2.2 Build de Producci√≥n del Cliente (Recomendado)

Para mejor rendimiento, construye el cliente y s√≠rvelo desde el servidor:

```bash
cd client
npm run build
```

Luego configura el servidor para servir los archivos est√°ticos (puedes usar `express.static` o cualquier servidor web).

## Paso 3: Acceder desde Otro Dispositivo

### 3.1 Conectar al Mismo WiFi/Red

Aseg√∫rate de que ambos dispositivos (servidor y cliente) est√°n en la misma red WiFi o LAN.

### 3.2 Abrir la Aplicaci√≥n

En el dispositivo desde el que quieres acceder (m√≥vil, tablet, etc.):

1. Abre un navegador web
2. Navega a: `http://[IP-DEL-SERVIDOR]:5173` (si usas dev server del cliente)
   - O a la URL donde est√©s sirviendo el cliente de producci√≥n

### 3.3 Configurar la URL del API

#### üåü Opci√≥n 1: Configuraci√≥n Autom√°tica (Recomendado)

Cuando abras TeamWorks desde un dispositivo remoto, ver√°s autom√°ticamente un **banner naranja en la parte superior** con el mensaje:

> ‚ö†Ô∏è **Configuraci√≥n de Red Requerida**

Este banner:
- ‚úÖ Detecta autom√°ticamente tu direcci√≥n IP
- ‚úÖ Sugiere la URL correcta del API
- ‚úÖ Verifica la conexi√≥n antes de aplicar cambios
- ‚úÖ Te avisa si algo no funciona

**Pasos:**
1. Haz clic en **"Configurar Autom√°ticamente"**
2. Espera unos segundos mientras verifica la conexi√≥n
3. Si todo va bien, ver√°s "‚úÖ Configuraci√≥n actualizada correctamente"
4. La p√°gina se recargar√° autom√°ticamente
5. ¬°Ya puedes iniciar sesi√≥n!

#### üîß Opci√≥n 2: Configuraci√≥n Manual (Si la autom√°tica no funciona)

Si prefieres configurar manualmente o la configuraci√≥n autom√°tica no funciona:

1. En la pantalla de Login/Register, ver√°s un bot√≥n flotante ‚öôÔ∏è en la esquina superior derecha
2. Haz click en el bot√≥n ‚öôÔ∏è (tambi√©n puedes hacer clic en "Configurar Manualmente" en el banner)
3. Se abrir√° el panel de Configuraci√≥n
4. En la secci√≥n "Configuraci√≥n del Servidor", campo "URL de la API":
   - Ingresa: `http://[IP-DEL-SERVIDOR]:3000/api`
   - Ejemplo: `http://192.168.0.165:3000/api`
5. Haz click en el bot√≥n de verificaci√≥n (icono de servidor) para comprobar la conexi√≥n
6. Si aparece "‚úì Conectado" en verde, la configuraci√≥n es correcta
7. Haz click en "Guardar"
8. La p√°gina se recargar√° autom√°ticamente

### 3.4 Crear Cuenta o Iniciar Sesi√≥n

Ahora ya puedes:
- Crear una cuenta nueva desde cualquier dispositivo
- Iniciar sesi√≥n con una cuenta existente
- Todas las peticiones ir√°n al servidor correcto

## Soluci√≥n de Problemas Comunes

### Error: "No se puede conectar al servidor"

**Causas posibles:**
1. El servidor no est√° ejecut√°ndose
2. La IP ingresada es incorrecta
3. El firewall est√° bloqueando el puerto 3000
4. Los dispositivos no est√°n en la misma red
5. **NUEVO**: Error de CORS (muy poco probable con la nueva configuraci√≥n)

**Soluciones:**
1. **Autom√°tica**: Si ves el banner naranja, prueba hacer clic en "Configurar Autom√°ticamente"
2. Verifica que el servidor est√© corriendo (`npm run dev` en carpeta server)
3. Confirma la IP con `ipconfig` (Windows) o `ifconfig` (Mac/Linux)
4. Revisa la configuraci√≥n del firewall (ver Paso 1.3)
5. Aseg√∫rate de que ambos dispositivos est√°n en la misma WiFi
6. **NUEVO**: Verifica los logs del servidor. La configuraci√≥n CORS ahora acepta autom√°ticamente conexiones desde red local.

### CORS Bloqueado / Error de Cross-Origin

**‚ö†Ô∏è SOLUCIONADO**: Este error ya no deber√≠a ocurrir con la nueva configuraci√≥n. El servidor ahora acepta autom√°ticamente:
- Todas las IPs de localhost (127.0.0.1, localhost, 0.0.0.0)
- Todas las IPs de red local privada (192.168.x.x, 10.x.x.x, 172.16-31.x.x)

Si a√∫n ves este error:
1. Reinicia el servidor completamente
2. Verifica que est√©s usando la √∫ltima versi√≥n del c√≥digo
3. Comprueba los logs del servidor para ver qu√© origin est√° siendo rechazado
4. Aseg√∫rate de que est√°s accediendo desde una IP de red local v√°lida

### El banner de configuraci√≥n autom√°tica no aparece

**Posibles razones:**
- Ya has configurado correctamente la URL del API anteriormente
- Est√°s accediendo desde localhost (no es necesaria la configuraci√≥n)

**Soluci√≥n:**
- Si aun as√≠ no puedes conectarte, usa la configuraci√≥n manual (bot√≥n ‚öôÔ∏è)

### Error: "Credenciales inv√°lidas" al registrar usuario

**Causa:** La URL del API no est√° configurada correctamente.

**Soluci√≥n:** Sigue el Paso 3.3 para configurar la URL del API antes de intentar registrarte.

### La p√°gina carga pero no muestra datos

**Causa:** El token de autenticaci√≥n puede estar guardado con una URL anterior.

**Soluci√≥n:**
1. Abre Settings (‚öôÔ∏è)
2. Verifica que la URL del API sea correcta
3. Cierra sesi√≥n y vuelve a iniciar sesi√≥n

### No puedo acceder desde el m√≥vil pero s√≠ desde el PC

**Causas posibles:**
1. El m√≥vil est√° usando datos m√≥viles en lugar de WiFi
2. Est√°s en una red WiFi de invitados que a√≠sla dispositivos

**Soluciones:**
1. Aseg√∫rate de que el m√≥vil est√° conectado al mismo WiFi
2. Si usas WiFi de invitados, con√©ctate al WiFi principal
3. Algunos routers tienen "aislamiento de clientes" activado - desact√≠valo en la configuraci√≥n del router

## Configuraci√≥n Avanzada

### Entendiendo la Configuraci√≥n CORS

La aplicaci√≥n ahora incluye una configuraci√≥n CORS inteligente que:
- ‚úÖ Permite autom√°ticamente conexiones desde localhost y todas sus variantes
- ‚úÖ Permite autom√°ticamente conexiones desde rangos de IP de red local privada
- ‚úÖ Permite conexiones configuradas expl√≠citamente via `FRONTEND_URL` en .env
- ‚úÖ Soporta credenciales (cookies, headers de autenticaci√≥n) de forma segura
- ‚úÖ Registra en consola cualquier origen rechazado para debugging

**No necesitas configurar FRONTEND_URL** para uso en red local. La configuraci√≥n CORS es autom√°tica.

Si quieres restringir el acceso a IPs espec√≠ficas, puedes configurar `FRONTEND_URL` en el archivo `.env` del servidor:
```env
FRONTEND_URL=http://192.168.1.100:5173
```

### Usar un Dominio Local

Si quieres usar un nombre de dominio en lugar de la IP:

1. Edita el archivo `hosts` en todos los dispositivos:
   - Windows: `C:\Windows\System32\drivers\etc\hosts`
   - macOS/Linux: `/etc/hosts`

2. A√±ade una l√≠nea:
   ```
   192.168.0.165  teamworks.local
   ```

3. Ahora puedes usar `http://teamworks.local:3000/api`

### HTTPS (Opcional)

Para usar HTTPS en red local, necesitar√≠as:

1. Generar certificado autofirmado
2. Configurar el servidor Express para usar HTTPS
3. Aceptar el certificado en cada dispositivo

**Nota**: HTTPS no es necesario para red local, solo para producci√≥n en internet.

### Servir Cliente y Servidor en el Mismo Puerto

Puedes configurar Express para servir los archivos est√°ticos del cliente:

```javascript
// server/src/index.ts
import path from 'path';

// Despu√©s de las rutas de API
app.use(express.static(path.join(__dirname, '../../client/dist')));

// Catch-all para SPA routing
app.get('*', (req, res) => {
  res.sendFile(path.join(__dirname, '../../client/dist/index.html'));
});
```

Entonces solo necesitas acceder a `http://[IP]:3000` (sin especificar puerto del cliente).

## Mejores Pr√°cticas

### Seguridad en Red Local

1. **No expongas a internet**: Esta configuraci√≥n es solo para red local
2. **Usa contrase√±as fuertes**: Especialmente si otros tienen acceso a tu red
3. **Mant√©n actualizado**: Actualiza dependencias regularmente

### Rendimiento

1. **Usa build de producci√≥n**: `npm run build` en el cliente
2. **Considera usar PM2**: Para mantener el servidor ejecut√°ndose
   ```bash
   npm install -g pm2
   pm2 start npm --name "teamworks-server" -- run dev
   ```

### Backup

1. **Base de datos**: Haz backup regular de PostgreSQL
   ```bash
   pg_dump teamworks > backup.sql
   ```

2. **Configuraci√≥n**: Guarda tu configuraci√≥n de Settings (se guarda autom√°ticamente en localStorage del navegador)

## Resumen R√°pido

### Para el usuario final (Nueva Experiencia Simplificada):

1. ‚úÖ Aseg√∫rate de que el servidor est√© corriendo en tu PC principal
2. ‚úÖ Obt√©n la IP del servidor (usa `ipconfig` en Windows o `ifconfig` en Mac/Linux)
3. ‚úÖ Abre TeamWorks en el dispositivo: `http://[IP]:5173`
4. ‚úÖ **¬°El banner naranja aparecer√° autom√°ticamente!**
5. ‚úÖ Haz clic en "Configurar Autom√°ticamente"
6. ‚úÖ Espera la confirmaci√≥n
7. ‚úÖ ¬°Listo para usar! Inicia sesi√≥n o reg√≠strate

### M√©todo tradicional (si prefieres configurar manualmente):

1. ‚úÖ Aseg√∫rate de que el servidor est√© corriendo
2. ‚úÖ Obt√©n la IP del servidor
3. ‚úÖ Abre TeamWorks en el dispositivo
4. ‚úÖ Click en ‚öôÔ∏è para abrir Settings
5. ‚úÖ Configura URL: `http://[IP]:3000/api`
6. ‚úÖ Verifica conexi√≥n (debe aparecer "Conectado")
7. ‚úÖ Guarda y recarga
8. ‚úÖ ¬°Listo para usar!

## Soporte

Si tienes problemas:
1. Revisa la consola del servidor para errores
2. Revisa la consola del navegador (F12 ‚Üí Console)
3. Usa el bot√≥n de ayuda (?) en la app para ver el manual completo
4. Verifica que ambos dispositivos est√°n en la misma red
